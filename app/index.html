<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Fabian Zeiher" />
    <title>Studie | Code Review Editor</title>
    <!-- semantic ui -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <!-- my style -->
    <link rel="stylesheet" href="./res/css/main.css">
</head>
<body>
    <div id="startup">
        <div id="spinner"></div>
        <h4 id="mobile-sorry" style="display:none;">Sorry, leider kann die Studie nicht auf mobilen Geräten oder Bildschirmen mit weniger als 1050 Pixel Breite durchgeführt werden.</h4>
    </div>
    <div id="app" style="display: none;">
        <main>
            <end-screen v-if="studyCompleted">byebye for now</end-screen>
            <template v-else>
                <final-survey v-if="isFinalSurvey" @study-completed="showFinalScreen"></final-survey>
                <template v-else>
                    <task-survey :task="currentTask" @task-survey-completed="finishCurrentTask" v-if="isTaskSurvey"></task-survey>
                    <template v-else>
                        <study-introduction></study-introduction>
                        <sui-message positive v-show="currentTask.isFinished && currentTask.surveyCompleted">
                            <sui-message-header>Task "{{currentTask.name }}" abgeschlossen</sui-message-header>
                            <p>Vielen Dank!</p>
                        </sui-message>
                        <study-controls @start-task="onStartTaskButtonClicked" @show-final-survey="showFinalSurvey" :allowexit="allowExit" :isfirsttask="isFirstTask" :tasklist="taskList" :maxtasknumber="tasks.length"></study-controls>
                    </template>
                </template>
            </template>
        </main>
        <agreements></agreements>
    </div>
    
    <script type="text/x-template" id="study-controls-component-template">
        <sui-segment>
            <sui-progress indicating :percent="progressPercent" :label="progressLabel" />
            <sui-button v-show="!exitConfirmationIsVisible" @click="toggleExitConfirmation" :disabled="!allowexit && !allTasksComplete" :primary="allTasksComplete">Studie Beenden</sui-button>
            <div v-show="exitConfirmationIsVisible" style="display: inline-block;">
                <h4 is="sui-header" style="display: inline-block; margin-right: 1rem;">Studie wirklich beenden?</h4>
                <div is="sui-button-group">
                    <sui-button @click="toggleExitConfirmation">Nein</sui-button>
                    <sui-button @click="$emit('show-final-survey')" primary>Ja</sui-button>
                </div>
            </div>
            <sui-button icon="right arrow" label-position="right" @click="$emit('start-task')" positive floated="right" :disabled="allTasksComplete">{{ isfirsttask ? "Exploration starten" : "Nächster Task"}}</sui-button>
        </sui-segment>
    </script>
    
    <script type="text/x-template" id="study-introduction-component-template">
        <div>
            <sui-segment basic>
                <h1 is="sui-header">Willkommen zur Code-Review-Editor-Remote-Usabililty-Studie</h1>
            </sui-segment>
            <sui-segment>
                <sui-container v-html="renderedMarkdown"></sui-container>
            </sui-segment>
        </div>
    </script>
    
    <script type="text/x-template" id="task-survey-component-template">
        <div>
            <sui-segment basic style="margin-bottom: 0;">
                <h1 is="sui-header">Fragebogen Task: {{ task.name }}</h1>
            </sui-segment>

            <sui-segment basic style="margin-top: 0;">
                <h4 is="sui-header">
                    <sui-icon name="lightbulb outline" />
                    <sui-header-content>
                        Als Erinnerungshilfe
                        <sui-header-subheader><p v-html="renderedTaskDescription"></p></sui-header-subheader>
                    </sui-header-content>
                </h4>
            </sui-segment>
            
            <sui-segment color="blue">
                <h4 is="sui-header">
                    <sui-icon name="info circle" />
                    <sui-header-content>
                        Hinweis
                        <sui-header-subheader>Danke für die Durchführung des Usability-Tasks! Bitte beantworte den folgenen Fragebogen so spontan und ehrlich wie möglich. Dieser Fragebogen bezieht sich auf den gerade von dir abgeschlossenen Usability-Task. Deine Meinung zur Usability und User-Experience des Systems ist uns wichtig. Bitte beachte: Wir bewerten nur die Anwendung, nicht die Nutzer*innen.</sui-header-subheader>
                    </sui-header-content>
                </h4>
            </sui-segment>

            <sui-segment>
                <h2 is="sui-header">
                    <sui-icon name="check" />
                    <sui-header-content>
                        Task Success
                        <sui-header-subheader>{{ taskSuccess.description }}</sui-header-subheader>
                    </sui-header-content>
                </h2>
                <sui-form size="large">
                    <sui-form-field inline>
                        <label>Task konnte erfolgreich abgeschlossen werden:</label>
                        <sui-dropdown placeholder="bitte auswählen" selection :options="taskSuccess.options" v-model="taskSuccess.value" />
                    </sui-form-field>
                </sui-form>
            </sui-segment>
            
            <sui-segment>
                <h2 is="sui-header">
                    <sui-icon name="clipboard" />
                    <sui-header-content>
                        {{ survey.title }}
                        <sui-header-subheader>{{ survey.description }}</sui-header-subheader>
                    </sui-header-content>
                </h2>
                <likert-table v-model="survey.items" :range="survey.likertRange"></likert-table>
            </sui-segment>
            
            <sui-segment basic aligned="right">
                <sui-button icon="save" label-position="left" @click="sendResults" primary :disabled="!isComplete">Ergebnisse abschicken</sui-button>
            </sui-segment>
            
        </div>
    </script>
    
    <script type="text/x-template" id="final-survey-component-template">
        <div>
            <sui-segment basic>
                <h1 is="sui-header">Abschlussfragebogen</h1>
            </sui-segment>

            <sui-segment color="blue">
                <h4 is="sui-header">
                    <sui-icon name="info circle" />
                    <sui-header-content>
                        Hinweis
                        <sui-header-subheader>Danke für die Bearbeitung der Usability-Tasks! Du hast es fast geschafft. Bitte beantworte den folgenen Fragebogen so spontan und ehrlich wie möglich. In diesem Fragebogen soll das System als ganzes - unabhängig von einzelnen Usability-Tasks - betrachtet werden.</sui-header-subheader>
                    </sui-header-content>
                </h4>
            </sui-segment>

            <sui-segment>
                <h2 is="sui-header">
                    <sui-icon name="clipboard" />
                    <sui-header-content>
                        {{ survey.title }}
                        <sui-header-subheader>{{ survey.description }}</sui-header-subheader>
                    </sui-header-content>
                </h2>
                <likert-table v-model="survey.items" :range="survey.likertRange"></likert-table>
            </sui-segment>
            
            <sui-segment basic aligned="right">
                <sui-button icon="sign out alternate" @click="sendResults" label-position="right" primary :disabled="!isComplete">Studie beenden</sui-button>
            </sui-segment>
        </div>
    </script>
    
    <script type="text/x-template" id="likert-table-component-template">
        <sui-table basic striped celled collapsing unstackable class="center-in-container">
            <sui-table-body>
                <sui-table-row v-for="(item, index) in value" :key="index">
                    <sui-table-cell v-if="item.question !== undefined">
                        <h4 is="sui-header">{{ item.question }}</h4>
                    </sui-table-cell>
                    <sui-table-cell text-align="right">{{ item.leftLabel }}</sui-table-cell>
                    <sui-table-cell text-align="center">
                        <sui-likert :inputValue="item.value" @input="bubbleEvent($event)" :range="range" :id="index.toString()"></sui-likert>
                    </sui-table-cell>
                    <sui-table-cell>{{ item.rightLabel }}</sui-table-cell>
                </sui-table-row>
            </sui-table-body>
        </sui-table>
    </script>
    
    <script type="text/x-template" id="likert-scale-component-template">
        <sui-form unstackable>
            <sui-form-fields inline style="margin: auto;">
                <sui-form-field v-for="index in rangeNumber" :key="index" style="padding-left: 8px; padding-right: 8px;">
                    <sui-checkbox radio :name="id" :value="index.toString()" :inputValue="inputValue" @change="bubbleEvent($event)"/>
                </sui-form-field>
            </sui-form-fields>
        </sui-form>
    </script>
    
    <script type="text/x-template" id="agreements-component-template">
        <sui-modal :open="open">
            <sui-modal-header>
                Vorraussetzungen und Datenschutz
            </sui-modal-header>
            <sui-modal-content scrolling>
                <sui-container v-html="renderedMarkdown"></sui-container>
            </sui-modal-content>
            <sui-modal-actions>
                <sui-checkbox toggle label="Ich erfülle die Vorraussetzungen und stimme den Datenschutzvereinbarungen zu." v-model="isChecked"></sui-checkbox>
                <sui-button positive @click.native="saveAgreement" :disabled="!isChecked">
                    Speichern
                </sui-button>
            </sui-modal-actions>
        </sui-modal>
    </script>

    <script type="text/x-template" id="end-screen-component-template">
        <div>
            <sui-segment basic>
                <h1 is="sui-header">Studie beendet</h1>
            </sui-segment>
            <sui-message positive>
                <sui-message-header>Vielen Dank</sui-message-header>
                <p>Vielen Dank für deine Teilnahme!</p>
            </sui-message>
            <sui-segment v-show="!feedbackWasSent">
                <sui-form>
                    <sui-form-field>
                      <label>Feedback</label>
                      <textarea v-model.trim="feedback" placeholder="Hinterlasse dein Feedback zur Studie und/oder dem Code-Review-Editor..."></textarea>
                    </sui-form-field>
                  </sui-form>
                  <sui-button icon="save" label-position="left" @click="sendFeedback" primary :disabled="feedback.length < 1">Feedback abschicken</sui-button>
            </sui-segment>
            <sui-message positive v-show="feedbackWasSent">
                <p>Vielen Dank für dein Feedback!</p>
            </sui-message>
        </div>
    </script>
    
    <!-- Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- vue semantic ui -->
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui-vue@0.11.0/dist/umd/semantic-ui-vue.min.js"></script>
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- html sanitizer -->
    <script src="https://cdn.jsdelivr.net/gh/jitbit/HtmlSanitizer@master/HtmlSanitizer.js"></script>
    <!-- app -->
    <script type="module" src="./res/js/main/main.js"></script>
    <script type="text/javascript" src="./res/js/utils/sui-likert-scale.js"></script>
</body>
</html>